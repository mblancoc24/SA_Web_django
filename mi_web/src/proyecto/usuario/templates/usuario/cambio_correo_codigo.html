{% extends 'usuario/principal.html' %}

{% block content %}
<div class="row">
  <div class="col-sm-9 col-md-7 col-lg-7 mx-auto">
    <div class="card border-0 shadow rounded-3 my-5">
      <div class="card-body p-4 p-sm-5">
        <h4 class="card-title text-center mb-5 fw-light fs-5 fw-bold">Cambio de Correo Electronico</h4>
        <h3 id="titulo" class="display-8" style="display: block;">Se ha enviado un codigo a su correo personal, para la verificacion del mismo.</h3>
        <div id="codigodisplay" style="display: block;">
                <div id="codigoenviado" data-codigo="{{ codigo }}" style="display: None;"></div>
                <div class="form-floating mb-3 col-md-12">
                  <input type="text" class="form-control" id="id_codigo" placeholder="Codigo"
                    name="codigo" autocomplete="codigo" required>
                  <label for="codigo" style="opacity: .65;">Ingrese Codigo</label>
                </div>
                <div class="d-grid">
                  <button type="submit" onclick="verificacion()" class="btn btn-primary btn-login fw-bold">Verificar Codigo</button>
                </div>
                <hr class="my-4">
        </div>

        <div id="cambio_correo" style="display: none;">
            <form class="row g-3 form" action="{% url 'change_email_correct' %}" method="POST">
                {% csrf_token %}
                <div class="form-floating mb-3 col-md-12">
                  <input type="text" class="form-control" id="id_nuevo_correo" placeholder="Nuevo Correo Electronico"
                    name="nuevo_correo" autocomplete="new-nuevo_correo" required>
                  <label for="nuevo_correo" style="opacity: .65;">Nuevo Correo Electronico</label>
                </div>
                <div class="form-floating mb-3 col-md-12">
                  <input type="text" class="form-control" id="id_nuevo_correo2"
                    placeholder="Confirmación de Correo Electronico" name="nuevo_correo2" required>
                  <label for="nuevo_correo2" style="opacity: .65;">Confirmación de Correo Electronico</label>
                </div>
                <div class="d-grid">
                  <button type="submit" class="btn btn-primary btn-login fw-bold">Cambiar Correo</button>
                </div>
                <hr class="my-4">
            </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
    function verificacion(){
        const codigo = document.getElementById("codigoenviado").getAttribute("data-codigo");
        var codigoescrito = document.getElementById("id_codigo").value;
        var titulo = document.getElementById("titulo");

        if(codigo === codigoescrito){
            var displaycode =  document.getElementById("codigodisplay");
            displaycode.style.display = "none";
            titulo.style.display = "none";

            var displayemail = document.getElementById("cambio_correo");
            displayemail.style.display = "block";
        }else{
            document.getElementById("id_codigo").value = "";
            document.getElementById("id_codigo").placeholder = "Codigo Incorrecto";
            document.getElementById("titulo").innerHTML = "Codigo Incorrecto";
        }
    }
</script>
{% endblock %}